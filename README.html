<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
    </head>

    <body class="markdown-body">
<!-- Page content mustn't be aligned, because of code blocks which will be moved. -->
<h1>RaketaFramework</h1>
<h2>Contents</h2>
<ol>
<li><a href="#hello">Hello World!</a></li>
<li><a href="#params">Reading URL parameters</a></li>
<li><a href="#urls">Flexible URLs</a></li>
<li><a href="#forms">Receiving forms</a></li>
<li><a href="#downloads">Downloads</a></li>
<li><a href="#license">License</a></li>
</ol>
<p><h2 id="hello">Hello World!</h2></p>
<p>Everyone knows, that tutorials usually start from “Hello World!”. I’ll make exception. Our first program using
RaketaFramework will show “Hello World!” twice :). Well, let’s write some code:</p>
<h5>Main.java:</h5>
<pre><code class="java"><span class="hljs-keyword">import</span> github.dmitmel.raketaframework.web.handle.*;
<span class="hljs-keyword">import</span> github.dmitmel.raketaframework.web.server.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        HandlersList handlersList = <span class="hljs-keyword">new</span> HandlersList(<span class="hljs-keyword">new</span> HelloHandler());
        Server server = <span class="hljs-keyword">new</span> Server(handlersList);
        server.start();
    }

    <span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/hello"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
        <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
        <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">GET</span><span class="hljs-params">(RequestData requestData)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World!\r\n"</span> + 
                    <span class="hljs-string">"Hello World!"</span>;
        }
    }
}
</code></pre>
<p>My congratulations! It’s your first app! To run it from terminal, you can type something like this:</p>
<pre><code class="bash">javac Main.java
java -cp libs/RaketaFramework-1.0.jar Main
</code></pre>
<p>And to use app, you can open page <code>http://localhost:8080/hello</code>.</p>
<p>Well, now I’ll describe some things in code.</p>
<h3>Code parts</h3>
<ol>
<li>
<p>All request handlers (for example, <code>HelloHandler</code>) must implement empty marker-interface
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestHandler.java"><code>github.dmitmel.raketaframework.web.handle.RequestHandler</code></a>
and be annotated by
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestURLPattern.java"><code>github.dmitmel.raketaframework.web.handle.RequestURLPattern</code></a>.
This annotation can set Regexp for URLs, which can be handled by this handler. Groups are supported, you can read about them in
next parts.</p>
</li>
<li>
<p>All handler methods must have 1 parameter and return value. You can read more detailed info about signatures
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestMethod.java">here</a>.
Also, they must be annotated using annotation
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestMethod.java"><code>github.dmitmel.raketaframework.web.handle.RequestMethod</code></a>.
This annotation describes on which web-method this Java-method will be used. But, you can’t set handler for <code>OPTIONS</code> -
this method must return supported web-methods.</p>
</li>
<li>
<p>Class <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java"><code>github.dmitmel.raketaframework.web.handle.RequestData</code></a>
stores data about request.</p>
</li>
</ol>
<p><h2 id="params">Reading URL parameters</h2></p>
<p>Well, this’s nice that we can send data to user, but what if user wants to talk with us? Let’s make request handler
which will return some greetings.</p>
<pre><code class="java"><span class="hljs-comment">// This class is inner class of Main</span>
<span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/greet"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Greeter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-function"><span class="hljs-keyword">private</span> Document <span class="hljs-title">GET</span><span class="hljs-params">(RequestData requestData)</span> </span>{
        Document document = <span class="hljs-keyword">new</span> Document();
        
        String who = requestData.getUrlParamOrElse(<span class="hljs-string">"who"</span>, <span class="hljs-string">"World"</span>);
        <span class="hljs-keyword">int</span> howMany = Integer.parseInt(requestData.getUrlParamOrElse(<span class="hljs-string">"how-many"</span>, <span class="hljs-string">"1"</span>));

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; howMany; i++) {
            document.writeF(<span class="hljs-string">"Hello, %s!\r\n"</span>, who);
        }
        
        <span class="hljs-keyword">return</span> document;
    }
}
</code></pre>
<p>Don’t forget to add new handler to handlers list!</p>
<pre><code class="java"><span class="hljs-comment">// First way (add handler in constructor):</span>
HandlersList handlersList = <span class="hljs-keyword">new</span> HandlersList(<span class="hljs-keyword">new</span> Greeter(), ...);
<span class="hljs-comment">// Second way (use method "add"):</span>
handlersList.add(<span class="hljs-keyword">new</span> Greeter());
</code></pre>
<p>What’s new?</p>
<ol>
<li>Class <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/Document.java"><code>github.dmitmel.raketaframework.web.handle.Document</code></a>.
It works like stream or <code>java.lang.StringBuilder</code> - you can append it’s data. It stores binary data, so you can put there
image.</li>
<li>Methods <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L27"><code>RequestData#getUrlParamOrElse</code></a>
and <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L24"><code>RequestData#getUrlParam</code></a>.
These methods simply return one of params in URL.</li>
</ol>
<p>Now, let’s use class <code>Greeter</code>!</p>
<pre><code class="bash"><span class="hljs-comment"># Imagine, that server has been already started</span>
curl -i <span class="hljs-string">'http://localhost:8080/greet?who=Dmitriy&amp;how-many=5'</span>
</code></pre>
<p>Output will be like this:</p>
<pre><code class="http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Connection</span>: close
<span class="hljs-attribute">Server</span>: RaketaFramework/1.0.0 on Mac OS X 10.11.5
<span class="hljs-attribute">Content-Length</span>: 85
<span class="hljs-attribute">Date</span>: 8:14:04 PM
<span class="hljs-attribute">Content-Type</span>: text/plain

<span class="erlang-repl">Hello, Dmitriy!
Hello, Dmitriy!
Hello, Dmitriy!
Hello, Dmitriy!
Hello, Dmitriy!
</span></code></pre>
<p><h2 id="urls">Flexible URLs</h2></p>
<p>As I said in the 1<sup>st</sup> part,</p>
<blockquote>
<p>This annotation can set URL regexp, which can be handled by this handler. Groups are supported, you can read about them in
next parts.</p>
</blockquote>
<p>Yeah, I’m talking about Regexps, URLs, and annotation
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestURLPattern.java"><code>github.dmitmel.raketaframework.web.handle.RequestURLPattern</code></a>.
Time to talk about them!</p>
<p>Let’s imagine, that we’re making handler for serving files. Client must send path of file. For example, he/she/it can
send path using URL param.</p>
<pre><code class="java"><span class="hljs-comment">// Usage: /load-file?path=...</span>
<span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/load-file"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span>[] GET(RequestData requestData) {
        String fileName = requestData.getUrlParam(<span class="hljs-string">"path"</span>);
        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-comment">/* Some code for loading files... */</span>;
        <span class="hljs-keyword">return</span> bytes;
    }
}
</code></pre>
<p>But, you can use Regexps!</p>
<pre><code class="java"><span class="hljs-comment">// Usage: /load-file/...</span>
<span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/load-file/(.+)"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span>[] GET(RequestData requestData) {
        String fileName = requestData.getMatcherGroup(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-comment">/* Some code for loading files... */</span>;
        <span class="hljs-keyword">return</span> bytes;
    }
}
</code></pre>
<p>Methods <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L31"><code>RequestData#getMatcherGroup</code></a>
and <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L34"><code>RequestData#getMatcherGroupOrElse</code></a>
return match groups from URL Regexp.</p>
<p><h2 id="forms">Receiving forms</h2></p>
<p>Many web-applications use forms. But how to receive them using RaketaFramework?</p>
<p>Let’s create simple greeting-app.</p>
<h5>In the Main.java:</h5>
<pre><code class="java"><span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/form-greeter"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormGreeter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">GET</span><span class="hljs-params">(RequestData requestData)</span> </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RedirectionThrowable(<span class="hljs-string">"/load-file/index.html"</span>);
    }
    
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"POST"</span>)
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">POST</span><span class="hljs-params">(WebFormData form)</span> </span>{
        <span class="hljs-keyword">if</span> (form.getFormParam(<span class="hljs-string">"name"</span>) == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error404();
        <span class="hljs-keyword">if</span> (form.getFormParam(<span class="hljs-string">"greet"</span>) == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error404();
        
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s %s!"</span>, form.getFormParam(<span class="hljs-string">"greet"</span>), form.getFormParam(<span class="hljs-string">"name"</span>));
    }
}
</code></pre>
<h5>index.html:</h5>
<pre><code class="html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Greet Form<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Hello, User!<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/form-greeter"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>What's your name?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"World"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>What greeting would you like<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>to have? (e.g. "Hi", "Hello")<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"greet"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Hello"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Submit"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>That’s all! But, some notes about code:</p>
<ol>
<li>You can send to client HTTP errors. To use them, you must just throw exception with name
<a href="https://github.com/dmitmel/RaketaFramework/tree/master/src/gen/java/github/dmitmel/raketaframework/web/errors"><code>Error${STATE}</code></a>.</li>
<li>To redirect user to other page, you must throw
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RedirectionThrowable.java"><code>github.dmitmel.raketaframework.web.handle.RedirectionThrowable</code></a></li>
</ol>
<p><h2 id="downloads">Downloads</h2></p>
<p>Binaries - <a href="https://raw.githubusercontent.com/dmitmel/RaketaFramework/master/build/jar/RaketaFramework-last.jar"><code>RaketaFramework-last.jar</code></a></p>
<p>Sources - <a href="https://raw.githubusercontent.com/dmitmel/RaketaFramework/master/build/jar/RaketaFramework-last-sources.zip"><code>RaketaFramework-last-sources.jar</code></a></p>
<p><h2 id="license">License</h2>
Copyright © 2016 Meleshko Dmitriy</p>
<p>Licensed under the Apache License, Version 2.0. You can get a copy at</p>
<pre><code><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></code></pre>


    </body>

    <link rel="stylesheet" href="file:///Users/dmitmel/.common-mark-gen/github-markdown-view-style.css">
    <link rel="stylesheet" href="file:///Users/dmitmel/node_modules/highlight.js/styles/github.css">
    <style>
        .markdown-body {
            padding: 10px 30px;
        }
    </style>
</html>
