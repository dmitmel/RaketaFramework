<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
    </head>

    <body class="markdown-body">
<!-- Page content mustn't be aligned, because of code blocks which will be moved. -->
<h1>RaketaFramework</h1>
<h2>Содержание</h2>
<ol>
<li><a href="#hello">Hello World!</a></li>
<li><a href="#params">Чтение параметров URL’ов</a></li>
<li><a href="#urls">Гибкие URL’ы</a></li>
<li><a href="#forms">Получение форм</a></li>
<li><a href="#downloads">Загрузки</a></li>
<li><a href="#license">Лицензия</a></li>
</ol>
<p><h2 id="hello">Hello World!</h2></p>
<p>Каждый знает, что туториалы обычно начинаются с “Hello World!”. Я сделаю исключение. Наша первая программа на
RaketaFramework’е будет показывать “Hello World!” дважды :). Итак, давайте напишем немного кода:</p>
<h5>Main.java:</h5>
<pre><code class="java"><span class="hljs-keyword">import</span> github.dmitmel.raketaframework.web.handle.*;
<span class="hljs-keyword">import</span> github.dmitmel.raketaframework.web.server.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        HandlersList handlersList = <span class="hljs-keyword">new</span> HandlersList(<span class="hljs-keyword">new</span> HelloHandler());
        Server server = <span class="hljs-keyword">new</span> Server(handlersList);
        server.start();
    }

    <span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/hello"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
        <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
        <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">GET</span><span class="hljs-params">(RequestData requestData)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World!\r\n"</span> + 
                    <span class="hljs-string">"Hello World!"</span>;
        }
    }
}
</code></pre>
<p>Мои поздравления! Это твоё первое приложение! Чтобы запустить его в терминале/консоли, ты можешь написать
что-нибудь вроде этого:</p>
<pre><code class="bash">javac Main.java
java -cp libs/RaketaFramework-1.0.jar Main
</code></pre>
<p>И чтоб использовать приложение, ты можешь зайти на <code>http://localhost:8080/hello</code>.</p>
<p>Итак, теперь я опишу пару вещей в коде.</p>
<h3>Code parts</h3>
<ol>
<li>
<p>Все обработчики запросов (например, <code>HelloHandler</code>) должны реализовать пустой интрефейс-маркер
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestHandler.java"><code>github.dmitmel.raketaframework.web.handle.RequestHandler</code></a>
и быть аннотированы аннотацией
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestURLPattern.java"><code>github.dmitmel.raketaframework.web.handle.RequestURLPattern</code></a>.
Эта аннотация может установить Regexp для URL’ов, которые могут быть обработаными этим обработчиком. Поддерживаются
группы, ты можешь почитать про них в следуйших частях.</p>
</li>
<li>
<p>Все методы-обработчики должны иметь 1 параметер и возвращать значение. Ты можешь почитать более детализированую
информацию о сигнатурах
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestMethod.java">здесь</a>.
Также, методы-обработчики должны быть аннотированы аннотацией
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestMethod.java"><code>github.dmitmel.raketaframework.web.handle.RequestMethod</code></a>.
Эта аннотация описывает на каком веб-методе этот Java-метод будет использован. Но, ты не можешь установить
обработчик для <code>OPTIONS</code> -
этот метод должен вернуть поддерживаемые методы.</p>
</li>
<li>
<p>Класс <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java"><code>github.dmitmel.raketaframework.web.handle.RequestData</code></a>
хранит информацию о запросе.</p>
</li>
</ol>
<p><h2 id="params">Чтение параметров URL’ов</h2></p>
<p>Ну, это хорошо что мы можем отправлять информацию пользователю, но что если пользователь хочет поговорить с нами?
Давайте сделаем обработчик запросов который может возвращать несколько приветствий.</p>
<pre><code class="java"><span class="hljs-comment">// Это внутренний класс класса Main</span>
<span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/greet"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Greeter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-function"><span class="hljs-keyword">private</span> Document <span class="hljs-title">GET</span><span class="hljs-params">(RequestData requestData)</span> </span>{
        Document document = <span class="hljs-keyword">new</span> Document();
        
        String who = requestData.getUrlParamOrElse(<span class="hljs-string">"who"</span>, <span class="hljs-string">"World"</span>);
        <span class="hljs-keyword">int</span> howMany = Integer.parseInt(requestData.getUrlParamOrElse(<span class="hljs-string">"how-many"</span>, <span class="hljs-string">"1"</span>));

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; howMany; i++) {
            document.writeF(<span class="hljs-string">"Hello, %s!\r\n"</span>, who);
        }
        
        <span class="hljs-keyword">return</span> document;
    }
}
</code></pre>
<p>Не забудь добавить новый обработчик в список обработчиков!</p>
<pre><code class="java"><span class="hljs-comment">// Первый способ (добавить обработчик в конструкторе):</span>
HandlersList handlersList = <span class="hljs-keyword">new</span> HandlersList(<span class="hljs-keyword">new</span> Greeter(), ...);
<span class="hljs-comment">// Второй способ (использовать метод "add"):</span>
handlersList.add(<span class="hljs-keyword">new</span> Greeter());
</code></pre>
<p>Что нового?</p>
<ol>
<li>Класс <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/Document.java"><code>github.dmitmel.raketaframework.web.handle.Document</code></a>.
Он работает на подобии потока или <code>java.lang.StringBuilder</code> - ты можешь добавлять в него данные. Он хранит
бинарные данные, так что ты можешь положить туда картинку.</li>
<li>Методы <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L27"><code>RequestData#getUrlParamOrElse</code></a>
и <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L24"><code>RequestData#getUrlParam</code></a>.
Эти методы просто возвращают один из параметров URL’а.</li>
</ol>
<p>Теперь, давайте поиспользуем класс <code>Greeter</code>!</p>
<pre><code class="bash"><span class="hljs-comment"># Представь, что сервер уже запущен</span>
curl -i <span class="hljs-string">'http://localhost:8080/greet?who=Dmitriy&amp;how-many=5'</span>
</code></pre>
<p>Вывод будет наподобии этого:</p>
<pre><code class="http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Connection</span>: close
<span class="hljs-attribute">Server</span>: RaketaFramework/1.0 on Mac OS X 10.11.5
<span class="hljs-attribute">Content-Length</span>: 85
<span class="hljs-attribute">Date</span>: Thu, Jul 7, 2016 07:50:18 AM GMT
<span class="hljs-attribute">Content-Type</span>: text/plain

<span class="erlang-repl">Hello, Dmitriy!
Hello, Dmitriy!
Hello, Dmitriy!
Hello, Dmitriy!
Hello, Dmitriy!
</span></code></pre>
<p><h2 id="urls">Гибкие URL’ы</h2></p>
<p>Как я сказал в первой части,</p>
<blockquote>
<p>Эта аннотация может установить Regexp для URL’ов, которые могут быть обработаными этим обработчиком. Поддерживаются
группы, ты можешь почитать про них в следуйших частях.</p>
</blockquote>
<p>Да, я говорю о Regexp’ах, URL’ах, и аннотации
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestURLPattern.java"><code>github.dmitmel.raketaframework.web.handle.RequestURLPattern</code></a>.
Время поговорить о них!</p>
<p>Давайте представим, что мы делаем обработчик для раздачи файлов. Клиент должен отправить путь к файлу. Например,
он/она/оно может отправить путь с помощью параметра URL’а.</p>
<pre><code class="java"><span class="hljs-comment">// Использование: /load-file?path=...</span>
<span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/load-file"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span>[] GET(RequestData requestData) {
        String fileName = requestData.getUrlParam(<span class="hljs-string">"path"</span>);
        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-comment">/* Немного кода для загрузки файлов... */</span>;
        <span class="hljs-keyword">return</span> bytes;
    }
}
</code></pre>
<p>Но, мы можем использовать Regexp’ы!</p>
<pre><code class="java"><span class="hljs-comment">// Использование: /load-file/...</span>
<span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/load-file/(.+)"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span>[] GET(RequestData requestData) {
        String fileName = requestData.getMatcherGroup(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-comment">/* Немного кода для загрузки файлов... */</span>;
        <span class="hljs-keyword">return</span> bytes;
    }
}
</code></pre>
<p>Методы <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L31"><code>RequestData#getMatcherGroup</code></a>
и <a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RequestData.java#L34"><code>RequestData#getMatcherGroupOrElse</code></a>
возвращают группы совпадения из Regexp’а URL’а.</p>
<p><h2 id="forms">Получение форм</h2></p>
<p>Много веб-приложений используют формы. Но как их можно получать используя RaketaFramework?</p>
<p>Давайте сделаем простое приветственное приложение.</p>
<h5>В Main.java:</h5>
<pre><code class="java"><span class="hljs-meta">@RequestURLPattern</span>(<span class="hljs-string">"/form-greeter"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormGreeter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span> </span>{
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"GET"</span>)
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">GET</span><span class="hljs-params">(RequestData requestData)</span> </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RedirectionThrowable(<span class="hljs-string">"/load-file/index.html"</span>);
    }
    
    <span class="hljs-meta">@RequestMethod</span>(<span class="hljs-string">"POST"</span>)
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">POST</span><span class="hljs-params">(WebFormData form)</span> </span>{
        <span class="hljs-keyword">if</span> (form.getFormParam(<span class="hljs-string">"name"</span>) == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error404();
        <span class="hljs-keyword">if</span> (form.getFormParam(<span class="hljs-string">"greet"</span>) == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error404();
        
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s %s!"</span>, form.getFormParam(<span class="hljs-string">"greet"</span>), form.getFormParam(<span class="hljs-string">"name"</span>));
    }
}
</code></pre>
<h5>index.html:</h5>
<pre><code class="html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Greet Form<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Hello, User!<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/form-greeter"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>What's your name?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"World"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>What greeting would you like<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>to have? (e.g. "Hi", "Hello")<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"greet"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Hello"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Submit"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Это всё! Но, немного заметок о коде:</p>
<ol>
<li>Ты можешь отсылать клиенту ошибки HTTP. Чтоб использовать их, ты должен просто вызвать исключение с именем
<a href="https://github.com/dmitmel/RaketaFramework/tree/master/src/gen/java/github/dmitmel/raketaframework/web/errors"><code>Error${STATE}</code></a>.</li>
<li>Чтобы перенаправить пользователя на другую страницу, ты должен вызвать исключение
<a href="https://github.com/dmitmel/RaketaFramework/blob/master/src/main/java/github/dmitmel/raketaframework/web/handle/RedirectionThrowable.java"><code>github.dmitmel.raketaframework.web.handle.RedirectionThrowable</code></a></li>
</ol>
<p><h2 id="downloads">Загрузки</h2></p>
<p>Бинарники - <a href="https://raw.githubusercontent.com/dmitmel/RaketaFramework/master/build/jar/RaketaFramework-last.jar"><code>RaketaFramework-last.jar</code></a></p>
<p>Исходники - <a href="https://raw.githubusercontent.com/dmitmel/RaketaFramework/master/build/jar/RaketaFramework-sources.jar"><code>RaketaFramework-last-sources.jar</code></a></p>
<p><h2 id="license">Лицензия</h2></p>
<p>Copyright © 2016 Meleshko Dmitriy</p>
<p>Лицензировано под Лицензией Apache, Версии 2.0. Ты можешь получить копию по ссылке</p>
<pre><code><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></code></pre>


    </body>

    <link rel="stylesheet" href="file:///Users/dmitmel/.common-mark-gen/github-markdown-view-style.css">
    <link rel="stylesheet" href="file:///Users/dmitmel/node_modules/highlight.js/styles/github.css">
    <style>
        .markdown-body {
            padding: 10px 30px;
        }
    </style>
</html>
